#!/usr/bin/env zsh

dn="$(pwd)"
while [ ! -e "$dn/paper-defs.zsh" ]; do
  if [ "$dn" = "/" ]; then
    echo -e "$(tput setaf 1)$(tput bold)paper-defs.zsh$(tput sgr0)$(tput dim) not found in $(pwd) or any parent directory.$(tput sgr0)"
    exit 1
  fi
  dn="${dn:h}"
  echo "$dn"
done
echo -e "$(tput bold)Paper directory$(tput sgr0): $(tput dim)$dn$(tput sgr0)"

export PAPER_DIR=$dn

cd "$PAPER_DIR"
dir="${0:A:h}"

if [ $1 = '--help' ]; then
  ls "$dir" | grep paper-
  exit 0
fi

cmd="paper-$1"
shift

found_command=0
for f in $(ls "$dir" | grep paper-); do
  [ $f != $cmd ] && continue
  found_command=1
  break
done

[ ! $found_command ] && echo "Command $cmd not found"

"$dir/$cmd" $@

