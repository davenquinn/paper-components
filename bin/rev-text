#!/usr/bin/env zsh

pushd "$PAPER_DIR/text"
dir="."
# If we don't have a revision, use current text
if [ -z "$1" ]; then
  paths=($dir/abstract.md \
    $(git ls-tree -r --full-name --name-only HEAD chapters) \
    $dir/figure-captions.md)
else
  paths=($dir/abstract.md \
    $(git ls-tree -r --full-name --name-only $1 chapters) \
    $dir/figure-captions.md)
fi

echo "# Key Points {-}\n\n"
if [ -z "$1" ]; then
  cat key-points.md
else
  git --no-pager show $1:key-points.md
fi
echo ""
echo "# Abstract {-}\n\n"

for fn in $paths; do
  if [ -z "$1" ]; then
    cat $fn
  else
    git --no-pager show $1:$fn
  fi
  echo "\n\n"
done

echo "# References {-}\n\n"
popd
